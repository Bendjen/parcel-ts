webpackJsonp([13],{962:function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.default={javaScriptText:'\nimport qs from "qs";\nimport { Toast } from "vant";\n\nlet _cache = {};\n\nconst defaultConfig = {\n  type: "post",\n  isCache: false,\n  isThrottle: false,\n  throttleTime: 0,\n  axiosConfig: {}\n};\n\n// \u6dfb\u52a0\u8bf7\u6c42\u62e6\u622a\u5668\naxios.interceptors.request.use(\n  function(config) {\n    Toast.loading({ mask: false, duration: 0, message: "\u52a0\u8f7d\u4e2d" });\n    return config;\n  },\n  function(error) {\n    Toast.fail("\u8bf7\u6c42\u51fa\u9519");\n    return Promise.reject({ msg: "\u8bf7\u6c42\u51fa\u9519" });\n  }\n);\n\n// \u6dfb\u52a0\u54cd\u5e94\u62e6\u622a\u5668\naxios.interceptors.response.use(\n  function(response) {\n    Toast.clear();\n    if (response.data.code == 200) {\n      let url = response.config.url,\n        params = response.config.data || "0",\n        res = response.request.responseText;\n      _cache[url] ? null : (_cache[url] = []);\n      let existCacheIndex;\n      let _cacheFliter = _cache[url].filter((item, index) => {\n        item.params == params ? (existCacheIndex = index) : null;\n        return item.params == params;\n      });\n\n      _cacheFliter.length > 0\n        ? (_cache[url][existCacheIndex] = { params, res })\n        : _cache[url].push({ params, res });\n      return response.data;\n    } else {\n      Toast.fail(response.data.msg || "\u670d\u52a1\u5668\u9519\u8bef");\n      return Promise.reject(response.data || { msg: "\u670d\u52a1\u5668\u9519\u8bef" });\n    }\n  },\n  function(error) {\n    Toast.clear();\n    Toast.fail("\u54cd\u5e94\u51fa\u9519");\n    return Promise.reject({ msg: "\u54cd\u5e94\u51fa\u9519" });\n  }\n);\n\n//\u622a\u6d41\u5904\u7406\nconst throttleProxy = fn => {\n  let lastRequest = 0;\n  return new Proxy(fn, {\n    apply(target, context, args) {\n      let _config = Object.assign(defaultConfig, args[1] || {});\n      let rate = _config.throttleTime !== 0 ? _config.throttleTime : 0;\n      if (Date.now() - lastRequest >= rate) {\n        lastRequest = Date.now();\n        return fn(...args);\n      } else {\n        console.warn("\u672c\u6b21\u8bf7\u6c42\u88ab\u622a\u6d41");\n        return Promise.reject({ msg: "\u672c\u6b21\u8bf7\u6c42\u88ab\u622a\u6d41" });\n      }\n    }\n  });\n};\n\n//\u751f\u6210\u90e8\u5206\nlet serviceGenerator = (map = {}) => {\n  let ApiMap = {};\n  Object.entries(map).forEach(item => {\n    let key_map = item[0],\n      value_map = item[1];\n    let outPutApi = (params = {}, config = {}) => {\n\n      //\u5408\u5e76\u9ed8\u8ba4\u53c2\u6570\n      let _config = Object.assign(defaultConfig, config);\n\n      //_axiosConfig\u53c2\u6570\u5408\u5e76\n      let _axiosConfig = Object.assign(\n        {\n          method: "post",\n          url: value_map,\n          data: qs.stringify(params)\n        },\n        _config.axiosConfig || {},\n        { method: _config.type.toLowerCase() || "post" }\n      );\n      ["put", "post", "patch"].every(value => _axiosConfig.method !== value)\n        ? (_axiosConfig.params = params)\n        : "";\n      let _request = () => axios(_axiosConfig);\n\n      //\u5904\u7406\u7f13\u5b58\u529f\u80fd\n      if (_config.isCache === true) {\n        if (_cache[value_map]) {\n          let _cacheFliter = _cache[value_map].filter(\n            item => item.params == qs.stringify(params)\n          );\n          if (_cacheFliter.length > 0) {\n            _request = () => {\n              console.warn(`\u60a8\u672c\u6b21\u8bf7\u6c42\u63a5\u53e3\uff1a${value_map} \u7684\u6570\u636e\u6765\u81ea\u7f13\u5b58\u3002`);\n              return Promise.resolve(JSON.parse(_cacheFliter[0].res));\n            };\n          }\n        }\n      }\n      return _request();\n    };\n\n    //\u622a\u6d41\u4ee3\u7406\n    ApiMap[key_map] = throttleProxy(outPutApi);\n  });\n  return ApiMap;\n};\n\nexport default serviceGenerator;\n\n',readMeText:"   1.\u6839\u636e\u63a5\u53e3\u5bf9\u8c61\u81ea\u52a8\u5c01\u88c5\u51fa\u5bf9\u5e94\u7684\u670d\u52a1\u5c42<br/>\n    2.\u52a0\u5165\u548c\u7f13\u5b58\u3001\u622a\u6d41\u7684\u53ef\u9009\u529f\u80fd<br/>\n    3.\u81ea\u52a8\u5904\u7406\u8bf7\u6c42\u524d\u7684\u52a0\u8f7d\u4e2d\u52a8\u753b\u4e0e\u8bf7\u6c42\u51fa\u9519\u7684\u63d0\u793a\u52a8\u753b\n",exampleText:'import serviceGenerator from "@utils/serviceGenerator";\n\nexport default serviceGenerator(\n  {\n    fetchFansList: "/r/FetchData/getAllDisCenterData",\n    fetchOrderList: "/r/FetchData/myOneFansDetail"\n  }\n);\n'}}});
//# sourceMappingURL=13.d0d129b4.chunk.js.map