webpackJsonp([45],{1390:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={cssText:'\n:local{\n  .container{\n    width: 100%;\n    padding: 20px;\n    h2{\n      font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;\n      font-size: 16px;\n      margin: 20px;\n    }\n  }\n  .button{\n    border:2px solid #E6F7FF;\n    border-radius: 5px;\n    cursor: pointer;\n    padding: 20px 60px;\n    margin: 0 30px;\n  }\n  .label{\n    padding-top: 20px;\n    font-size: 14px;\n  }\n  .cameraContainer,.pictureBase64{\n    max-width: 600px;\n    max-height: 600px;\n  }\n  .rect {\n    border-radius: 2px;\n    border: 3px solid white;\n    // box-shadow: 0 16px 28px 0 rgba(0, 0, 0, 0.3);\n    cursor: pointer;\n    left: -1000px;\n    position: absolute;\n    top: -1000px;\n  }\n\n  .postScript{\n    margin: 40px 0;\n    text-align: center;\n  }\n  \n}\n',javaScriptText:"\nimport React from \"react\";\nimport { Icon, message, Modal } from 'antd';\nimport \"antd/dist/antd.css\";\nimport style from \"./index.scss\";\nclass FaceDetection extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      pictureLoading: false,\n      cameraLoading: false,\n      pictureBase64: '',\n      pictureFaceRect: [],\n      videoFaceRect: [],\n      cropFace: [],\n      pictureModalVisible: false,\n      cameraModalVisible: false\n    };\n    this.handlePictureClick = this.handlePictureClick.bind(this);\n    this.handleCameraClick = this.handleCameraClick.bind(this);\n    this.fileChange = this.fileChange.bind(this);\n    this.handlePictureCancel = this.handlePictureCancel.bind(this);\n    this.handlePictureOk = this.handlePictureOk.bind(this);\n    this.handleCameraCancel = this.handleCameraCancel.bind(this);\n    this.handleCameraOk = this.handleCameraOk.bind(this);\n    this.pictureInput = React.createRef();\n    this.addScript();\n  }\n\n  addScript() {\n    const scriptTracking = document.createElement(\"script\");\n    scriptTracking.setAttribute(\"type\", \"text/javascript\");\n    scriptTracking.setAttribute(\"src\", \"lib/tracking-min.js\");\n    const scriptFace = document.createElement(\"script\");\n    scriptFace.setAttribute(\"type\", \"text/javascript\");\n    scriptFace.setAttribute(\"src\", \"lib/face-min.js\");\n    const scriptWebcam = document.createElement(\"script\");\n    scriptWebcam.setAttribute(\"type\", \"text/javascript\");\n    scriptWebcam.setAttribute(\"src\", \"lib/webcam.min.js\");\n    document.documentElement.appendChild(scriptFace);\n    document.documentElement.appendChild(scriptTracking);\n    document.documentElement.appendChild(scriptWebcam);\n  }\n\n  handlePictureClick() {\n    if ((!tracking || !Webcam) && !this.pictureLoading) {\n      this.setState({ pictureLoading: true })\n      setTimeout(() => {\n        this.setState({ pictureLoading: false })\n      }, 5000)\n    } else {\n      this.pictureInput.current.click()\n    }\n  }\n\n  handleCameraClick() {\n    let that = this;\n    if ((!tracking || !Webcam) && !this.cameraLoading) {\n      this.setState({ cameraLoading: true })\n      setTimeout(() => {\n        this.setState({ cameraLoading: false })\n      }, 5000)\n    } else {\n      this.setState({ cameraModalVisible: true })\n      const hideCameraLoading = message.loading('\u6b63\u5728\u8fde\u63a5\u6444\u50cf\u5934..', 0);\n      setTimeout(() => {\n        Webcam.attach('#camera');\n        hideCameraLoading()\n        const tracker = new tracking.ObjectTracker(['face'])\n        // tracker.setScaleFactor(2)   // 1.1 ~ 2\n        // tracker.setStepSize(2)      // 1.1 ~ 2  \u8d8a\u5927\uff0c\u80fd\u8bc6\u522b\u7684\u4eba\u8138\u7279\u5199\u8d8a\u5927\n        tracker.on('track', (event) => {\n          that.setState({ videoFaceRect: event.data })\n        })\n\n        function addCameraTrack() {\n          setTimeout(() => {\n            const vedio = document.querySelector('#camera video')\n            if (vedio) {\n              tracking.track('#camera video', tracker);\n            } else {\n              addCameraTrack()\n            }\n          }, 1000)\n        }\n        addCameraTrack()\n\n      }, 500);\n    }\n  }\n\n  fileChange() {\n    const that = this;\n    const reader = new FileReader();\n    const file = this.pictureInput.current.files[0];\n    if (file) {\n      const hideReadLoading = message.loading('\u8bfb\u53d6\u56fe\u7247..', 0);\n      reader.readAsDataURL(file);\n      reader.onload = (e) => {\n        hideReadLoading()\n        const hideDetectLoading = message.loading('\u6b63\u5728\u8bc6\u522b\u4eba\u50cf..', 0);\n        this.setState({ pictureBase64: e.target.result, pictureModalVisible: true })\n        setTimeout(() => {\n          const tracker = new tracking.ObjectTracker(['face'])\n          // faces.setScaleFactor(2)   // 1.1 ~ 2\n          // faces.setStepSize(2)      // 1.1 ~ 2  \u8d8a\u5927\uff0c\u80fd\u8bc6\u522b\u7684\u4eba\u8138\u7279\u5199\u8d8a\u5927\n          tracker.on('track', (event) => {\n            hideDetectLoading()\n            if (event.data.length === 0) {\n              message.warning('\u672a\u80fd\u5728\u8be5\u56fe\u7247\u4e2d\u8bc6\u522b\u5230\u4eba\u8138\uff0c\u8bf7\u907f\u514d\u9634\u5f71\u4e0e\u9006\u5149\uff0c\u4e14\u786e\u4fdd\u56fe\u7247\u8d28\u91cf\u6e05\u6670\u3002', 3);\n            } else {\n              that.setState({ pictureFaceRect: event.data })\n            }\n          })\n          tracking.track('#pictureBase64', tracker, { camera: true });\n        }, 1000)\n      };\n      reader.onerror = () => {\n        hideLoading()\n        this.setState({ pictureBase64: '' })\n      }\n    }\n  }\n\n  handlePictureOk() {\n    if (this.state.pictureFaceRect.length === 0) {\n      message.warning('\u6ca1\u6709\u53ef\u8bc6\u522b\u7684\u4eba\u50cf\u4f9b\u6355\u83b7', 3);\n      this.setState({ pictureModalVisible: false, pictureFaceRect: [] })\n    } else {\n      const img = document.getElementById(\"pictureBase64\");\n      const canvas = document.getElementById(\"mycanvas\")\n      const faceCtx = canvas.getContext('2d');\n      const imgList = [];\n      this.state.pictureFaceRect.forEach(rect => {\n        canvas.width = rect.width;\n        canvas.height = rect.height;\n        faceCtx.drawImage(img, rect.x, rect.y, rect.width, rect.height, 0, 0, rect.width, rect.height)\n        const faceBase64 = canvas.toDataURL(\"image/png\");\n        imgList.push(faceBase64)\n      })\n      this.setState({ cropFace: imgList, pictureModalVisible: false, pictureFaceRect: [] })\n    }\n    this.pictureInput.current.value = ''\n  }\n\n  handlePictureCancel() {\n    this.pictureInput.current.value = ''\n    this.setState({ pictureModalVisible: false, pictureFaceRect: [] })\n  }\n\n  handleCameraOk() {\n    if (this.state.videoFaceRect.length === 0) {\n      message.warning('\u6ca1\u6709\u53ef\u8bc6\u522b\u7684\u4eba\u50cf\u4f9b\u6355\u83b7', 3);\n      this.setState({ cameraModalVisible: false, videoFaceRect: [] })\n    } else {\n      const vedio = document.querySelector('#camera video');\n      const canvas = document.getElementById(\"mycanvas\")\n      const faceCtx = canvas.getContext('2d');\n      const imgList = [];\n      this.state.videoFaceRect.forEach(rect => {\n        canvas.width = rect.width;\n        canvas.height = rect.height;\n        faceCtx.drawImage(vedio, rect.x, rect.y, rect.width, rect.height, 0, 0, rect.width, rect.height)\n        const faceBase64 = canvas.toDataURL(\"image/png\");\n        imgList.push(faceBase64)\n      })\n      this.setState({ cropFace: imgList, cameraModalVisible: false, videoFaceRect: [] })\n    }\n  }\n\n  handleCameraCancel() {\n    this.setState({ cameraModalVisible: false, videoFaceRect: [] })\n    Webcam.reset()\n  }\n\n  renderPictureModal() {\n    return (\n      <Modal\n        title=\"\u4eba\u8138\u91c7\u96c6\"\n        width={800}\n        okText='\u6355\u83b7\u4eba\u50cf'\n        cancelText='\u53d6\u6d88'\n        visible={this.state.pictureModalVisible}\n        onOk={this.handlePictureOk}\n        onCancel={this.handlePictureCancel}\n      >\n        <div data-flex='main:center corss:center' id='pictureContainer'>\n          <img id='pictureBase64' className={style.pictureBase64} src={this.state.pictureBase64} />\n          {this.state.pictureFaceRect.map((rect, index) => {\n            const img = document.getElementById('pictureBase64')\n            if (img) {\n              return (<div className={style.rect} id={`rect${index}`} key={index} style={{ width: rect.width, height: rect.height, left: img.offsetLeft + rect.x, top: img.offsetTop + rect.y }}></div>)\n            } else {\n              return null\n            }\n          })}\n        </div>\n      </Modal>\n    )\n  }\n\n  renderCameraModal() {\n    return (\n      <Modal\n        title=\"\u4eba\u8138\u91c7\u96c6\"\n        width={800}\n        okText='\u6355\u83b7\u4eba\u50cf'\n        cancelText='\u53d6\u6d88'\n        visible={this.state.cameraModalVisible}\n        onOk={this.handleCameraOk}\n        onCancel={this.handleCameraCancel}\n      >\n        <div data-flex='main:center corss:center'>\n          <div id=\"camera\" style={{ width: 600, height: 600 }}></div>\n          {this.state.videoFaceRect.map((rect, index) => {\n            const video = document.querySelector('#camera video')\n            if (video) {\n              return (<div className={style.rect} id={`rect${index}`} key={index} style={{ width: rect.width, height: rect.height, left: video.offsetLeft + rect.x, top: video.offsetTop + rect.y }}></div>)\n            } else {\n              return null\n            }\n          })}\n        </div>\n      </Modal>\n    )\n  }\n\n  render() {\n    return (\n      <div className={style.container}>\n        {/* \u4eba\u50cf\u6765\u6e90 */}\n        <h2>\u9009\u62e9\u4eba\u50cf\u6765\u6e90\uff1a</h2>\n        <div data-flex='main:center cross:center'>\n          <div className={style.button} onClick={this.handlePictureClick}>\n            {this.state.pictureLoading ?\n              <div data-flex='dir:top main:center cross:center' >\n                <Icon type=\"loading\" style={{ fontSize: 120, color: \"#1890FF\" }} />\n                <span className={style.label}>\u8d44\u6e90\u52a0\u8f7d\u4e2d...</span>\n              </div>\n              :\n              <div data-flex='dir:top main:center cross:center'>\n                <Icon type=\"picture\" style={{ fontSize: 120 }} theme=\"twoTone\" />\n                <span className={style.label}>\u9009\u62e9\u56fe\u7247</span>\n              </div>\n            }\n          </div>\n          <div className={style.button} onClick={this.handleCameraClick}>\n            {this.state.cameraLoading ?\n              <div data-flex='dir:top main:center cross:center' >\n                <Icon type=\"loading\" style={{ fontSize: 120, color: \"#1890FF\" }} />\n                <span className={style.label}>\u8d44\u6e90\u52a0\u8f7d\u4e2d...</span>\n              </div>\n              :\n              <div data-flex='dir:top main:center cross:center'>\n                <Icon type=\"camera\" style={{ fontSize: 120 }} theme=\"twoTone\" />\n                <span className={style.label}>\u73b0\u573a\u62cd\u6444</span>\n              </div>\n            }\n          </div>\n          <input type=\"file\" hidden accept=\"image/*\" ref={this.pictureInput} onChange={this.fileChange}></input>\n        </div>\n        <p className={style.postScript}>\u8bf4\u660e\uff1a\u8fc7\u5927\u7684\u4eba\u8138\u7279\u5199\u53ef\u80fd\u5bfc\u81f4\u65e0\u6cd5\u8bc6\u522b\uff0c\u8bf7\u9009\u7528\u4eba\u8138\u5927\u5c0f\u9002\u4e2d\u7684\u56fe\u7247\u3002</p>\n        {/* \u6240\u6355\u83b7\u4eba\u50cf */}\n        <h2>\u6355\u83b7\u4eba\u50cf\uff1a</h2>\n        <div data-flex='main:center cross:center' style={{ flexWrap: 'wrap' }}>\n          {this.state.cropFace.map((base64, index) => {\n            return <img style={{ margin: '0 20px' }} key={index} src={base64}></img>\n          })}\n        </div>\n\n        <canvas id=\"mycanvas\" hidden></canvas>\n        {this.renderPictureModal()}\n        {this.renderCameraModal()}\n      </div>\n    );\n  }\n}\n\nexport default FaceDetection;\n"}}});
//# sourceMappingURL=45.58428949.chunk.js.map